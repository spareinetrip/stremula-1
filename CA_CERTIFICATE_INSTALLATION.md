# CA Certificate Installation Guide

To eliminate certificate warnings on macOS, iOS, and tvOS, install the Root CA certificate generated by Stremula.

## Download the CA Certificate

1. **From your server:**
   - Open: `https://YOUR_SERVER_IP:7004/ca.crt`
   - Or download from: `http://localhost:7003/ca.crt` (if accessing locally)

2. **The file will be named:** `stremula-ca.crt`

## Installation Instructions

### macOS

1. **Double-click** the `stremula-ca.crt` file
2. **Keychain Access** will open automatically
3. Find **"Stremula Root CA"** in the **"login"** keychain
4. **Double-click** the certificate
5. Expand **"Trust"** section
6. Set **"When using this certificate"** to **"Always Trust"**
7. Close the window and enter your password when prompted

**Alternative method (Terminal):**
```bash
sudo security add-trusted-cert -d -r trustRoot -k /Library/Keychains/System.keychain stremula-ca.crt
```

### iOS

iOS requires a Configuration Profile to install CA certificates. You can create one manually or use a tool.

**Option 1: Using Apple Configurator 2 (Recommended)**
1. Download Apple Configurator 2 from the Mac App Store
2. Create a new profile
3. Add the CA certificate to the profile
4. Install the profile on your iOS device

**Option 2: Using a Web Server**
1. Create a `.mobileconfig` file (see template below)
2. Host it on a web server
3. Open the URL on your iOS device
4. Install the profile

**Option 3: Manual Installation (iOS 13+)**
1. Email the `.crt` file to yourself
2. Open the email on your iOS device
3. Tap the attachment
4. Go to **Settings → General → About → Certificate Trust Settings**
5. Enable trust for "Stremula Root CA"

### tvOS

tvOS requires a Configuration Profile installed via Apple Configurator 2 or MDM:

1. Use **Apple Configurator 2** to create a profile
2. Add the CA certificate to the profile
3. Install the profile on your Apple TV

**Note:** tvOS doesn't support manual certificate installation like iOS.

## Configuration Profile Template

For iOS/tvOS, create a `.mobileconfig` file:

```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
    <key>PayloadContent</key>
    <array>
        <dict>
            <key>PayloadType</key>
            <string>com.apple.security.root</string>
            <key>PayloadUUID</key>
            <string>UNIQUE-UUID-HERE</string>
            <key>PayloadIdentifier</key>
            <string>com.stremula.rootca</string>
            <key>PayloadVersion</key>
            <integer>1</integer>
            <key>PayloadDisplayName</key>
            <string>Stremula Root CA</string>
            <key>PayloadDescription</key>
            <string>Root CA certificate for Stremula server</string>
            <key>PayloadCertificateFileName</key>
            <string>stremula-ca.crt</string>
            <key>PayloadContent</key>
            <data>
            <!-- Base64 encoded CA certificate content goes here -->
            </data>
        </dict>
    </array>
    <key>PayloadDisplayName</key>
    <string>Stremula CA Certificate</string>
    <key>PayloadIdentifier</key>
    <string>com.stremula.certificate</string>
    <key>PayloadRemovalDisallowed</key>
    <false/>
    <key>PayloadType</key>
    <string>Configuration</string>
    <key>PayloadUUID</key>
    <string>UNIQUE-UUID-HERE</string>
    <key>PayloadVersion</key>
    <integer>1</integer>
</dict>
</plist>
```

To generate the Base64 content:
```bash
base64 -i stremula-ca.crt | tr -d '\n'
```

## Verification

After installation:

1. **macOS:** Open Keychain Access → System → Certificates → Verify "Stremula Root CA" shows "Trusted"
2. **iOS:** Settings → General → About → Certificate Trust Settings → Verify "Stremula Root CA" is enabled
3. **Test:** Visit `https://YOUR_SERVER_IP:7004/manifest.json` - should load without warnings

## Troubleshooting

- **Certificate still shows warnings:** Clear browser cache and restart the browser
- **iOS won't install:** Make sure you're using iOS 13+ or a Configuration Profile
- **tvOS:** Must use Apple Configurator 2 or MDM - manual installation not supported
- **Certificate expired:** The CA certificate is valid for 10 years. Server certificates are regenerated automatically.

## Security Note

⚠️ **Important:** Only install this CA certificate on devices you trust. Anyone with access to the CA private key can create trusted certificates for any domain/IP.

